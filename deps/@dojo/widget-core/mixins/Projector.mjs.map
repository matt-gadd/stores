{"version":3,"file":"Projector.mjs","sourceRoot":"","sources":["../../../src/mixins/Projector.ts"],"names":[],"mappings":"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","sourcesContent":["import { assign } from '@dojo/core/lang';\nimport global from '@dojo/shim/global';\nimport { createHandle } from '@dojo/core/lang';\nimport { Handle } from '@dojo/core/interfaces';\nimport 'pepjs';\nimport cssTransitions from '../animations/cssTransitions';\nimport { Constructor, DNode, Projection, ProjectionOptions } from './../interfaces';\nimport { WidgetBase } from './../WidgetBase';\nimport { afterRender } from './../decorators/afterRender';\nimport { v } from './../d';\nimport { Registry } from './../Registry';\nimport { dom, widgetInstanceMap } from './../vdom';\n\n/**\n * Represents the attach state of the projector\n */\nexport enum ProjectorAttachState {\n\tAttached = 1,\n\tDetached\n}\n\n/**\n * Attach type for the projector\n */\nexport enum AttachType {\n\tAppend = 1,\n\tMerge = 2,\n\tReplace = 3\n}\n\nexport interface AttachOptions {\n\t/**\n\t * If `'append'` it will appended to the root. If `'merge'` it will merged with the root. If `'replace'` it will\n\t * replace the root.\n\t */\n\ttype: AttachType;\n\n\t/**\n\t * Element to attach the projector.\n\t */\n\troot?: Element;\n}\n\nexport interface ProjectorProperties {\n\tregistry?: Registry;\n}\n\nexport interface ProjectorMixin<P> {\n\treadonly properties: Readonly<P> & Readonly<ProjectorProperties>;\n\n\t/**\n\t * Append the projector to the root.\n\t */\n\tappend(root?: Element): Handle;\n\n\t/**\n\t * Merge the projector onto the root.\n\t *\n\t * The `root` and any of its `children` will be re-used.  Any excess DOM nodes will be ignored and any missing DOM nodes\n\t * will be created.\n\t * @param root The root element that the root virtual DOM node will be merged with.  Defaults to `document.body`.\n\t */\n\tmerge(root?: Element): Handle;\n\n\t/**\n\t * Replace the root with the projector node.\n\t */\n\treplace(root?: Element): Handle;\n\n\t/**\n\t * Pause the projector.\n\t */\n\tpause(): void;\n\n\t/**\n\t * Resume the projector.\n\t */\n\tresume(): void;\n\n\t/**\n\t * Attach the project to a _sandboxed_ document fragment that is not part of the DOM.\n\t *\n\t * When sandboxed, the `Projector` will run in a sync manner, where renders are completed within the same turn.\n\t * The `Projector` creates a `DocumentFragment` which replaces any other `root` that has been set.\n\t * @param doc The `Document` to use, which defaults to the global `document`.\n\t */\n\tsandbox(doc?: Document): void;\n\n\t/**\n\t * Schedule a render.\n\t */\n\tscheduleRender(): void;\n\n\t/**\n\t * Sets the properties for the widget. Responsible for calling the diffing functions for the properties against the\n\t * previous properties. Runs though any registered specific property diff functions collecting the results and then\n\t * runs the remainder through the catch all diff function. The aggregate of the two sets of the results is then\n\t * set as the widget's properties\n\t *\n\t * @param properties The new widget properties\n\t */\n\tsetProperties(properties: this['properties']): void;\n\n\t/**\n\t * Sets the widget's children\n\t */\n\tsetChildren(children: DNode[]): void;\n\n\t/**\n\t * Return a `string` that represents the HTML of the current projection.  The projector needs to be attached.\n\t */\n\ttoHtml(): string;\n\n\t/**\n\t * Indicates if the projectors is in async mode, configured to `true` by defaults.\n\t */\n\tasync: boolean;\n\n\t/**\n\t * Root element to attach the projector\n\t */\n\troot: Element;\n\n\t/**\n\t * The status of the projector\n\t */\n\treadonly projectorState: ProjectorAttachState;\n\n\t/**\n\t * Exposes invalidate for projector instances\n\t */\n\tinvalidate(): void;\n\n\t/**\n\t * Runs registered destroy handles\n\t */\n\tdestroy(): void;\n}\n\nexport function ProjectorMixin<P, T extends Constructor<WidgetBase<P>>>(Base: T): T & Constructor<ProjectorMixin<P>> {\n\tclass Projector extends Base {\n\t\tpublic projectorState: ProjectorAttachState;\n\t\tpublic properties: Readonly<P> & Readonly<ProjectorProperties>;\n\n\t\tprivate _root: Element;\n\t\tprivate _async = true;\n\t\tprivate _attachHandle: Handle;\n\t\tprivate _projectionOptions: Partial<ProjectionOptions>;\n\t\tprivate _projection: Projection | undefined;\n\t\tprivate _scheduled: number | undefined;\n\t\tprivate _paused: boolean;\n\t\tprivate _boundDoRender: () => void;\n\t\tprivate _boundRender: Function;\n\t\tprivate _projectorChildren: DNode[] = [];\n\t\tprivate _projectorProperties: this['properties'] = {} as this['properties'];\n\t\tprivate _handles: Function[] = [];\n\n\t\tconstructor(...args: any[]) {\n\t\t\tsuper(...args);\n\n\t\t\tconst instanceData = widgetInstanceMap.get(this)!;\n\n\t\t\tinstanceData.parentInvalidate = () => {\n\t\t\t\tthis.scheduleRender();\n\t\t\t};\n\t\t\tthis._projectionOptions = {\n\t\t\t\ttransitions: cssTransitions\n\t\t\t};\n\n\t\t\tthis._boundDoRender = this._doRender.bind(this);\n\t\t\tthis._boundRender = this.__render__.bind(this);\n\t\t\tthis.root = document.body;\n\t\t\tthis.projectorState = ProjectorAttachState.Detached;\n\t\t}\n\n\t\tpublic append(root?: Element): Handle {\n\t\t\tconst options = {\n\t\t\t\ttype: AttachType.Append,\n\t\t\t\troot\n\t\t\t};\n\n\t\t\treturn this._attach(options);\n\t\t}\n\n\t\tpublic merge(root?: Element): Handle {\n\t\t\tconst options = {\n\t\t\t\ttype: AttachType.Merge,\n\t\t\t\troot\n\t\t\t};\n\n\t\t\treturn this._attach(options);\n\t\t}\n\n\t\tpublic replace(root?: Element): Handle {\n\t\t\tconst options = {\n\t\t\t\ttype: AttachType.Replace,\n\t\t\t\troot\n\t\t\t};\n\n\t\t\treturn this._attach(options);\n\t\t}\n\n\t\tpublic pause() {\n\t\t\tif (this._scheduled) {\n\t\t\t\tglobal.cancelAnimationFrame(this._scheduled);\n\t\t\t\tthis._scheduled = undefined;\n\t\t\t}\n\t\t\tthis._paused = true;\n\t\t}\n\n\t\tpublic resume() {\n\t\t\tthis._paused = false;\n\t\t\tthis.scheduleRender();\n\t\t}\n\n\t\tpublic scheduleRender() {\n\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\tthis.__setProperties__(this._projectorProperties);\n\t\t\t\tthis.__setChildren__(this._projectorChildren);\n\t\t\t\t(this as any)._renderState = 1;\n\t\t\t\tif (!this._scheduled && !this._paused) {\n\t\t\t\t\tif (this._async) {\n\t\t\t\t\t\tthis._scheduled = global.requestAnimationFrame(this._boundDoRender);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._boundDoRender();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic set root(root: Element) {\n\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\tthrow new Error('Projector already attached, cannot change root element');\n\t\t\t}\n\t\t\tthis._root = root;\n\t\t}\n\n\t\tpublic get root(): Element {\n\t\t\treturn this._root;\n\t\t}\n\n\t\tpublic get async(): boolean {\n\t\t\treturn this._async;\n\t\t}\n\n\t\tpublic set async(async: boolean) {\n\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\tthrow new Error('Projector already attached, cannot change async mode');\n\t\t\t}\n\t\t\tthis._async = async;\n\t\t}\n\n\t\tpublic sandbox(doc: Document = document): void {\n\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\tthrow new Error('Projector already attached, cannot create sandbox');\n\t\t\t}\n\t\t\tthis._async = false;\n\t\t\tconst previousRoot = this.root;\n\n\t\t\t/* free up the document fragment for GC */\n\t\t\tthis.own(() => {\n\t\t\t\tthis._root = previousRoot;\n\t\t\t});\n\n\t\t\tthis._attach({\n\t\t\t\t/* DocumentFragment is not assignable to Element, but provides everything needed to work */\n\t\t\t\troot: doc.createDocumentFragment() as any,\n\t\t\t\ttype: AttachType.Append\n\t\t\t});\n\t\t}\n\n\t\tpublic setChildren(children: DNode[]): void {\n\t\t\tthis.__setChildren__(children);\n\t\t\tthis.scheduleRender();\n\t\t}\n\n\t\tpublic __setChildren__(children: DNode[]) {\n\t\t\tthis._projectorChildren = [...children];\n\t\t\tsuper.__setChildren__(children);\n\t\t}\n\n\t\tpublic setProperties(properties: this['properties']): void {\n\t\t\tthis.__setProperties__(properties);\n\t\t\tthis.scheduleRender();\n\t\t}\n\n\t\tpublic __setProperties__(properties: this['properties']): void {\n\t\t\tif (this._projectorProperties && this._projectorProperties.registry !== properties.registry) {\n\t\t\t\tif (this._projectorProperties.registry) {\n\t\t\t\t\tthis._projectorProperties.registry.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._projectorProperties = assign({}, properties);\n\t\t\tsuper.__setCoreProperties__({ bind: this, baseRegistry: properties.registry });\n\t\t\tsuper.__setProperties__(properties);\n\t\t}\n\n\t\tpublic toHtml(): string {\n\t\t\tif (this.projectorState !== ProjectorAttachState.Attached || !this._projection) {\n\t\t\t\tthrow new Error('Projector is not attached, cannot return an HTML string of projection.');\n\t\t\t}\n\t\t\treturn (this._projection.domNode.childNodes[0] as Element).outerHTML;\n\t\t}\n\n\t\t@afterRender()\n\t\tpublic afterRender(result: DNode) {\n\t\t\tlet node = result;\n\t\t\tif (typeof result === 'string' || result === null || result === undefined) {\n\t\t\t\tnode = v('span', {}, [result]);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t}\n\n\t\tprivate _doRender() {\n\t\t\tthis._scheduled = undefined;\n\n\t\t\tif (this._projection) {\n\t\t\t\tthis._projection.update(this._boundRender());\n\t\t\t}\n\t\t}\n\n\t\tprivate own(handle: Function): void {\n\t\t\tthis._handles.push(handle);\n\t\t}\n\n\t\tpublic destroy() {\n\t\t\twhile (this._handles.length > 0) {\n\t\t\t\tconst handle = this._handles.pop();\n\t\t\t\tif (handle) {\n\t\t\t\t\thandle();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _attach({ type, root }: AttachOptions): Handle {\n\t\t\tif (root) {\n\t\t\t\tthis.root = root;\n\t\t\t}\n\n\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\treturn this._attachHandle;\n\t\t\t}\n\n\t\t\tthis.projectorState = ProjectorAttachState.Attached;\n\n\t\t\tconst handle = () => {\n\t\t\t\tif (this.projectorState === ProjectorAttachState.Attached) {\n\t\t\t\t\tthis.pause();\n\t\t\t\t\tthis._projection = undefined;\n\t\t\t\t\tthis.projectorState = ProjectorAttachState.Detached;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.own(handle);\n\t\t\tthis._attachHandle = createHandle(handle);\n\n\t\t\tthis._projectionOptions = { ...this._projectionOptions, ...{ sync: !this._async } };\n\n\t\t\tswitch (type) {\n\t\t\t\tcase AttachType.Append:\n\t\t\t\t\tthis._projection = dom.append(this.root, this._boundRender(), this, this._projectionOptions);\n\t\t\t\t\tbreak;\n\t\t\t\tcase AttachType.Merge:\n\t\t\t\t\tthis._projection = dom.merge(this.root, this._boundRender(), this, this._projectionOptions);\n\t\t\t\t\tbreak;\n\t\t\t\tcase AttachType.Replace:\n\t\t\t\t\tthis._projection = dom.replace(this.root, this._boundRender(), this, this._projectionOptions);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this._attachHandle;\n\t\t}\n\t}\n\n\treturn Projector;\n}\n\nexport default ProjectorMixin;\n"]}